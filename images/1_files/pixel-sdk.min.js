!function(a){"use strict";a.PIXEL_SDK_ENVIRONMENT="production";var l,i,t,o,s,r,e={ENVIRONMENT:a.PIXEL_SDK_ENVIRONMENT||"development",PIXEL_SERVICE_URL:{development:"http://localhost:8081",staging:"//stg-pixel.playbuzz.com",production:"//pixel.playbuzz.com"},PIXEL_SERVICE_METHOD_ITEM:"/v1/item/",PIXEL_SERVICE_METHOD_STREAM:"/v1/stream/",PIXEL_SERVICE_METHOD_BRANDED_ELEMENT:"/v1/branded-element/",PIXEL_SERVICE_METHOD_CAMPAIGN:"/v1/campaign/",PIXEL_SERVICE_METHOD_PLAYBUZZ:"/v1/playbuzz/",PIXEL_SERVICE_METHOD_PLAYBUZZ_NETWORK:"/v1/playbuzz-network/",EVENT_NAMES:{item:"pbItemEvent",stream:"pbStreamEvent",brandedElement:"pbBrandedElementEvent",playbuzz:"pbEvent"},PB_KINESIS:{staging:"https://prd-collector-anon.playbuzz.com/main/events",development:"https://prd-collector-anon.playbuzz.com/main/events",production:"https://prd-collector-anon.playbuzz.com/main/events"},ITEM_ID:(a.pbItem?a.pbItem.id:"")||(a.gameData?a.gameData.gameId:""),PAGE_LOAD_UID:a.plbzPid||a.pbPageIdentifier||"",PRELOADED_PIXELS_DATA:a.preloadedPixelsData||null},n=(l="display:none !important;",{inject:function(t,e){e=e||{};var n,i,a,o,s,r,c,d=(n=document.createElement(t),(i=e).id&&n.setAttribute("id",i.id),i.className&&n.setAttribute("class",i.className),n.setAttribute("style",l),n);e.parentId&&e.content?(document.getElementById(e.parentId).appendChild(d),"iframe"===t?(d.contentDocument.open(),d.contentDocument.write("<html><body>"+e.content+"</body></html>"),d.contentDocument.close()):d.appendChild((a=e.content,o=/<script[\s\S]*?>[\s\S]*?<\/script>/gi,s=document.createDocumentFragment(),r=a.match(o),(c=document.createElement("TEMPLATE")).innerHTML=a.replace(o,""),s.appendChild(c.content),r&&r.forEach(function(t){var e,n=document.createElement("SCRIPT"),i=t.replace(/<script[\s\S]*?>/gi,"").replace(/<\/script>/gi,"").replace(/\n/gi,"");e=n,function(t){var e=document.createElement("div");e.innerHTML=t;var n,i=e.firstChild,a=[];if(i.attributes)for(n=0;n<i.attributes.length;n++)a.push(i.attributes[n]);else if(i.getAttributeNames){var o=i.getAttributeNames();for(n=0;n<o.length;n++)a.push({name:o[n],value:i.getAttribute(o[n])})}return a}(t).forEach(function(t){t.name&&t.value&&e.setAttribute(t.name,t.value)}),n.appendChild(document.createTextNode(i)),s.appendChild(n)}),s))):document.body.appendChild(d)},dispatchEvent:function(t,e){var n=document.createEvent("CustomEvent");n.initCustomEvent(t,!1,!1,e),document.body.dispatchEvent(n)},listen:function(t,e){document.body.addEventListener(t,e)}}),c=function(){function o(t,e,n,i,a){var o=new XMLHttpRequest;return o.open(t,e,!0),o.onreadystatechange=function(){var t,e;e=i,4!==(t=o).readyState||200!==t.status&&(e&&e(),1)||n&&n(o.response)},o}return{get:function(t,e,n){new o("GET",t,e,n).send()},post:function(t,e,n,i){var a=new o("POST",t,n,i);a.setRequestHeader("Content-Type","application/json;"),a.send(e?JSON.stringify(e):null)}}}(),d=(i=c,o=(t=e).PB_KINESIS[t.ENVIRONMENT],s=(new Date).getTime(),r={articleId:t.ITEM_ID||null,pageLoadUid:t.PAGE_LOAD_UID},{send:function(t,e){var n={};n.deltaTime=(((new Date).getTime()-s)/1e3).toFixed(2),n.eventName=t,n=function(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}(e,n,r),i.post(o,n)}}),p=function(t,e,n){this.events=n,this.data=t,this.dom=e,this.className="sdk-pixel",this.pixelSdkEventName="pixelSdkEvent",this.fired=!1,this.macros={"{cb}":function(){return(new Date).getTime()}},"story.engagement"===this.data.event.type&&this.createDelayedPixel()};function E(t,e,n,i,a,o){this.events=o,this.http=t,this.configs=e,this.Pixel=n,this.dom=i,this.itemId=a,this.pixelsContainerId="pixel-sdk-container",this.pixels=[],this.serviceUri=this.configs.PIXEL_SERVICE_URL[this.configs.ENVIRONMENT]}function m(t,e){f(this,e,h(JSON.parse(t),this))}function u(t){}function h(t,e){for(var n,i,a,o=e,s=[],r=0;r<t.length;r++){var c=t[r];c.html=decodeURIComponent(c.html),s.push((n=c,a=void 0,(a=new(i=o).Pixel(n,i.dom,i.events)).init(),i.pixels.push(a),a))}return s}function f(t,e,n){var i=t;e||(e=i.configs.EVENT_NAMES.item),i.dom.listen(e,function(e){n.forEach(function(t){t.matchAndInject(e)})})}p.prototype.createDelayedPixel=function(){var t=this;setTimeout(function(){t.fired||(t.fired=!0,t.injectDelayed())},this.data.event.delay)},p.prototype.replaceMacros=function(t){t=t||"";for(var e in this.macros)-1<t.indexOf(e)&&(t="function"==typeof this.macros[e]?t.replace(e,this.macros[e]()):t.replace(e,this.macros[e]));return t},p.prototype.init=function(){var t=!0,e=!1;this.data.targeting&&(t=this.matchURL(this.data.targeting),e=this.isBSExcluded(this.data.targeting)),!this.data.event.data&&"story.engagement"!==this.data.event.type&&t&&!1===e&&this.inject()},p.prototype.matchAndInject=function(t){var e=this,n=e.matchName(t.detail.name,e.data.event),i=e.matchData(t.detail.data,e.data.event.data),a=e.matchURL(e.data.targeting||{}),o=e.isBSExcluded(e.data.targeting||{});n&&i&&a&&!1===o&&(e.data.event.fireOnce&&!e.fired?(e.fired=!0,e.inject()):e.data.event.fireOnce||e.inject())},p.prototype.isBSExcluded=function(t){if(t.excludeBS){var e=a.parent,n=e.pbItem&&e.pbItem.sponsored&&e.pbItem.sponsored.enabled,i=e.gameData&&"True"===e.gameData.isBranded;return e===a.top&&(i||n)}return!1},p.prototype.matchData=function(t,e){var n=Object.assign({},t),i=!0;for(var a in e&&void 0===e.itemActionId&&delete n.itemActionId,e)void 0!==n[a]&&n[a]===e[a]||(i=!1);return i},p.prototype.matchName=function(t,e){return"story.engagement"===e.type?-1!==e.names.indexOf(t):t===e.name},p.prototype.matchURL=function(t){var e=parent!==a?document.referrer:a.location.href,n=!0;return t.urls&&t.urls.length&&("include"===t.mode?(n=!1,t.urls.forEach(function(t){n=n||-1!==e.indexOf(t)})):"exclude"===t.mode&&(n=!0,t.urls.forEach(function(t){n=n&&-1===e.indexOf(t)}))),n},p.prototype.notify=function(t,e){this.events.send("pixel_injected",{pixelId:this.data.id}),this.dom.dispatchEvent(this.pixelSdkEventName,{name:t,data:e})},p.prototype.sendEvent=function(){},p.prototype.injectDelayed=function(){this.inject(!0)},p.prototype.inject=function(t){this.data.html=this.replaceMacros(this.data.html),this.dom.inject("noIFrame"===this.data.mode?"div":"iframe",{id:this.data.id,className:this.className,content:t?this.data.htmlDelayed:this.data.html,parentId:"pixel-sdk-container"}),this.notify("pixel-sdk.pixel.injected",this.data)},E.prototype.init=function(){this.dom.inject("div",{id:this.pixelsContainerId})},E.prototype.initPreloadedPixels=function(){this.configs.PRELOADED_PIXELS_DATA&&f(this,null,h(this.configs.PRELOADED_PIXELS_DATA,this))},E.prototype.initItem=function(){if(this.itemId){var e=this,t=this.serviceUri+this.configs.PIXEL_SERVICE_METHOD_ITEM+this.itemId;this.http.get(t,function(t){m.call(e,t,e.configs.EVENT_NAMES.item)},u)}},E.prototype.initBrandedElement=function(t,e){var n=this;if(t){var i=this.serviceUri+this.configs.PIXEL_SERVICE_METHOD_BRANDED_ELEMENT+t;this.http.get(i,function(t){m.call(n,t,n.configs.EVENT_NAMES.brandedElement)},u)}if(e){var a=this.serviceUri+this.configs.PIXEL_SERVICE_METHOD_CAMPAIGN+e;this.http.get(a,function(t){m.call(n,t,n.configs.EVENT_NAMES.brandedElement)},u)}},E.prototype.initStream=function(t){if(t){var e=this,n=this.serviceUri+this.configs.PIXEL_SERVICE_METHOD_STREAM+t;this.http.get(n,function(t){m.call(e,t,e.configs.EVENT_NAMES.stream)},u)}},E.prototype.initPlaybuzz=function(){var e=this,t=this.serviceUri+this.configs.PIXEL_SERVICE_METHOD_PLAYBUZZ;this.http.get(t,function(t){m.call(e,t,e.configs.EVENT_NAMES.playbuzz)},u)},E.prototype.initPlaybuzzNetwork=function(){var e=this,t=this.serviceUri+this.configs.PIXEL_SERVICE_METHOD_PLAYBUZZ_NETWORK;this.http.get(t,function(t){m.call(e,t,e.configs.EVENT_NAMES.item)},u)};var v,I=new E(c,e,p,n,e.ITEM_ID,d);a.pbPixelSDK||(a.preloadedPixelsData?(I.init(),I.initPreloadedPixels()):setTimeout(function(){I.init(),I.initItem()})),(v=a.document.querySelectorAll(".new-item-stats")[0])||(v=a.document.querySelectorAll(".embed-stat")[0]),(v?"false"!==v.getAttribute("is-embed"):(v=a.document.getElementById("app"))&&"true"===v.getAttribute("data-embed"))&&I.initPlaybuzzNetwork(),a.pbPixelSDK=I}(window);